### **Part 1: The Visual Design System — "Execemy Clarity"**

We'll define a strict design system to ensure every thumbnail feels professional, consistent, and on-brand. The "McKinsey-like" aesthetic means prioritizing clarity, data, and structure over photographic imagery.

**Design Tokens (to be used in `satori`):**

*   **Font:** We will load and use the `Inter` font family, which you already have. We need `Inter-Regular`, `Inter-Medium`, and `Inter-Bold`.
*   **Colors:**
    *   `background`: `oklch(0.98 0.01 240)` (A very light, almost white gray)
    *   `foreground`: `oklch(0.15 0.02 240)` (A deep, near-black blue)
    *   `accent`: `oklch(0.5 0.2 260)` (A strong, professional blue)
    *   `muted`: `oklch(0.6 0.01 240)` (A medium gray for subtitles)
*   **Icons:** A consistent set of `lucide-react` icons, mapped to your 10 core domains.
*   **Layout:** A 12-column grid system (implemented with Flexbox) on a standard 1200x630 canvas (the standard for Open Graph images).

---

### **Part 2: The Two Core Thumbnail Templates**

We will create two primary templates: one for `Lessons` (knowledge transfer) and one for `Case Studies` (application and data analysis). This visual distinction is crucial.

#### **Template 1: The `Lesson` Thumbnail**
*   **Purpose:** To clearly communicate the core concept and its place in the curriculum. It should feel like a page from an authoritative report.
*   **Visual Metaphor:** A structured document.
*   **Layout (1200x630):**
    *   **Background:** Solid `background` color.
    *   **Header (Top):**
        *   "Execemy Program" wordmark in top-left.
        *   Domain Name (`font-medium`, `muted` color) in top-right.
    *   **Main Content:**
        *   **Left 1/3:** A large, clean **Domain Icon** (e.g., `DollarSign`) rendered in the `accent` color with low opacity.
        *   **Right 2/3:** The **Lesson Title**, wrapped and rendered in large, bold `foreground` text. This is the hero element.
    *   **Footer (Bottom):**
        *   A thin line in the `accent` color separating the footer.
        *   **Metadata Badges:**
            *   "Lesson"
            *   "12 min read"
            *   "Advanced"

#### **Template 2: The `Case Study` Thumbnail**
*   **Purpose:** To signal that this is an analytical, data-driven challenge.
*   **Visual Metaphor:** A data visualization or chart.
*   **Layout (1200x630):**
    *   **Background:** Same `background` color but with a faint, repeating dot grid pattern.
    *   **Header:** Same as the Lesson template for brand consistency.
    *   **Main Content:**
        *   **Key Difference:** Instead of a large icon, this template will feature an **AI-generated abstract data visualization SVG**. This is the core innovation.
        *   The **Case Study Title** will be overlaid on top of this visualization.
    *   **Footer:**
        *   Same thin accent line.
        *   **Metadata Badges:**
            *   "Case Study"
            *   "90 min sim"
            *   "Advanced"

---

### **Part 3: The AI-Assisted Generation Workflow (The Core Innovation)**

This is the most critical part. We will use Gemini 2.5 Flash for its speed and ability to generate structured data. The generation process will be part of your content pipeline, triggered within the admin panel.

#### **Step 1: The `generate-thumbnail` Supabase Edge Function**

This function will orchestrate the entire process. It takes `contentId` and `contentType` ('lesson' or 'case') as input.

```typescript
// In supabase/functions/generate-thumbnail/index.ts

import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
import { Resvg } from "https://esm.sh/@resvg/resvg-js@2.6.0";
import satori from "https://esm.sh/satori@0.10.9";
import { html } from "https://esm.sh/satori-html@0.6.1";
import * as React from "https://esm.sh/react@18.2.0";

// Simplified handler - full code in Part 4
serve(async (req) => {
  // 1. Get metadata for the content from your DB.
  // 2. Based on contentType, decide which template to use.
  // 3. For 'case' type, call Gemini to get the abstract data-viz SVG.
  // 4. Construct the JSX for the satori template.
  // 5. Use satori to render the JSX to an SVG string.
  // 6. Use resvg to convert the SVG to a PNG (more compatible).
  // 7. Upload the PNG to Supabase Storage.
  // 8. Update the content's `thumbnail_url` in your DB.
  
  return new Response("Thumbnail generated", { status: 200 });
});
```

#### **Step 2: The Gemini Prompt for Abstract Data Visualization**

When the function is called for a `Case Study`, it will first make a call to the Gemini API with a highly specific prompt.

**Prompt for Gemini 2.5 Flash:**
> "You are an expert data visualization designer with a minimalist, abstract aesthetic. Your task is to generate a single, clean SVG representing a business concept.
>
> **Business Concept:** 'The US-China Decoupling'
> **Primary Competency:** 'Geopolitical & Regulatory Navigation'
>
> **Instructions:**
> 1.  Generate a valid SVG string. Do NOT wrap it in markdown.
> 2.  The SVG canvas must be `viewBox="0 0 400 400"`.
> 3.  The design must be abstract and minimalist. Use simple shapes: lines, circles, rectangles.
> 4.  Use ONLY the following colors: `path` stroke=`"oklch(0.5 0.2 260)"` (blue), `circle` fill=`"oklch(0.98 0.01 240)"` (light gray).
> 5.  Represent the 'decoupling' concept visually. For example, two clusters of shapes moving apart, connected by fewer, strained lines.
> 6.  Keep it clean and professional. It should look like a chart from The Economist or a McKinsey report, but without text or axes.
>
> **Output only the SVG code.**"

This prompt is fast, cheap, and gives you a unique, thematically relevant, and stylistically consistent visual element for every case study.

---

### **Part 4: Specific Technical Implementation Details**

#### **1. File Structure Additions**

```
execemy/
├── components/
│   └── thumbnails/
│       ├── LessonThumbnail.tsx
│       └── CaseStudyThumbnail.tsx
└── supabase/
    └── functions/
        └── generate-thumbnail/
            └── index.ts
```

#### **2. Thumbnail React Components**

These are server-side only, designed for `satori`.

```typescript
// components/thumbnails/LessonThumbnail.tsx
import * as React from 'react';

export const LessonThumbnail = ({ title, domainName, iconSvgPath }) => (
  <div style={{ display: 'flex', flexDirection: 'column', height: '100%', width: '100%', padding: '40px', backgroundColor: 'oklch(0.98 0.01 240)', color: 'oklch(0.15 0.02 240)' }}>
    {/* Header */}
    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '24px', color: 'oklch(0.6 0.01 240)' }}>
      <span>Execemy Program</span>
      <span>{domainName}</span>
    </div>

    {/* Main Content */}
    <div style={{ display: 'flex', flexGrow: 1, alignItems: 'center' }}>
      <div style={{ width: '33%', display: 'flex', justifyContent: 'center', opacity: 0.1 }}>
        <svg width="200" height="200" viewBox="0 0 24 24" fill="none" stroke="oklch(0.5 0.2 260)" strokeWidth="1.5">
          {/* Use dangerouslySetInnerHTML to inject lucide icon path */}
          <g dangerouslySetInnerHTML={{ __html: iconSvgPath }} />
        </svg>
      </div>
      <div style={{ width: '67%', paddingLeft: '40px' }}>
        <h1 style={{ fontSize: '72px', fontWeight: 700, lineHeight: 1.1, letterSpacing: '-2px' }}>
          {title}
        </h1>
      </div>
    </div>

    {/* Footer */}
    <div style={{ borderTop: '2px solid oklch(0.5 0.2 260)', paddingTop: '20px', display: 'flex', gap: '24px', fontSize: '24px' }}>
      <span>Lesson</span>
      <span>12 min read</span>
      <span>Advanced</span>
    </div>
  </div>
);
```

```typescript
// components/thumbnails/CaseStudyThumbnail.tsx
import * as React from 'react';

export const CaseStudyThumbnail = ({ title, domainName, dataVizSvg }) => (
  <div style={{ display: 'flex', flexDirection: 'column', height: '100%', width: '100%', padding: '40px', backgroundColor: 'oklch(0.98 0.01 240)', color: 'oklch(0.15 0.02 240)' }}>
    {/* Header */}
    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '24px', color: 'oklch(0.6 0.01 240)' }}>
      <span>Execemy Program</span>
      <span>{domainName}</span>
    </div>

    {/* Main Content with AI-generated SVG background */}
    <div style={{ display: 'flex', flexGrow: 1, alignItems: 'center', position: 'relative' }}>
      <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, display: 'flex', justifyContent: 'center', alignItems: 'center', opacity: 0.2 }}
           dangerouslySetInnerHTML={{ __html: dataVizSvg }}
      />
      <h1 style={{ fontSize: '72px', fontWeight: 700, lineHeight: 1.1, letterSpacing: '-2px', textAlign: 'center', width: '100%' }}>
        {title}
      </h1>
    </div>

    {/* Footer */}
    <div style={{ borderTop: '2px solid oklch(0.5 0.2 260)', paddingTop: '20px', display: 'flex', gap: '24px', fontSize: '24px' }}>
      <span>Case Study</span>
      <span>90 min sim</span>
      <span>Advanced</span>
    </div>
  </div>
);
```

#### **3. Supabase Edge Function (`generate-thumbnail`)**

This is a simplified but functional version of the logic.

```typescript
// supabase/functions/generate-thumbnail/index.ts (conceptual)

// ... (imports for satori, resvg, supabase, etc.)

// Helper to get Lucide icon SVG path
async function getIconPath(iconName: string): Promise<string> {
    // In a real Deno env, you might fetch this from a CDN or have them locally
    // For this example, we'll use a placeholder.
    // A real implementation would map 'DollarSign' to its <path> data.
    return `<path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />`;
}

serve(async (req) => {
    const { contentId, contentType } = await req.json();

    // 1. Fetch metadata from DB using Supabase client
    const { data: contentData, error } = await supabase.from(contentType === 'lesson' ? 'articles' : 'cases').select('title, domain(name, icon)').eq('id', contentId).single();

    if (error) throw new Error("Content not found");

    let template;

    if (contentType === 'lesson') {
        const iconPath = await getIconPath(contentData.domain.icon);
        template = html(<LessonThumbnail title={contentData.title} domainName={contentData.domain.name} iconSvgPath={iconPath} />);
    } else {
        // 2. Call Gemini for the abstract data-viz SVG
        const geminiResponse = await callGeminiForDataViz(contentData.title, contentData.domain.name);
        template = html(<CaseStudyThumbnail title={contentData.title} domainName={contentData.domain.name} dataVizSvg={geminiResponse} />);
    }

    // 3. Load Inter font data
    const fontData = await fetch('https://.../Inter-Bold.ttf').then(res => res.arrayBuffer());

    // 4. Use satori to generate SVG
    const svg = await satori(template, {
        width: 1200,
        height: 630,
        fonts: [{ name: 'Inter', data: fontData, weight: 700 }],
    });

    // 5. Use resvg to convert to PNG for better compatibility
    const resvg = new Resvg(svg);
    const pngData = resvg.render();
    const pngBuffer = pngData.asPng();

    // 6. Upload PNG to Supabase Storage
    const filePath = `thumbnails/${contentId}.png`;
    const { data: uploadData, error: uploadError } = await supabase.storage.from('assets').upload(filePath, pngBuffer, { contentType: 'image/png', upsert: true });

    if (uploadError) throw uploadError;

    // 7. Get public URL and update DB
    const { data: { publicUrl } } = supabase.storage.from('assets').getPublicUrl(filePath);
    await supabase.from(contentType === 'lesson' ? 'articles' : 'cases').update({ thumbnail_url: publicUrl }).eq('id', contentId);

    return new Response(JSON.stringify({ success: true, url: publicUrl }), { headers: { "Content-Type": "application/json" } });
});
```

This comprehensive system provides you with a powerful, automated, and brand-aligned method for creating visually appealing thumbnails that enhance the user experience and reinforce the professional, data-driven identity of your platform.