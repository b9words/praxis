# Praxis Platform MVP

The proving ground for the next generation of ambitious leaders. A full-stack application combining interactive business simulations, AI-powered coaching, and a private learning community.

## Tech Stack

- **Frontend**: Next.js 14 with App Router, TypeScript, Tailwind CSS, Shadcn/ui
- **Backend**: Supabase (PostgreSQL, Auth, Storage, Edge Functions)
- **AI**: Google Gemini API
- **Charts**: Recharts
- **Deployment**: Vercel (frontend), Local Supabase (development)

## Features

### Core Features (100% Complete)
- ✅ User authentication with Supabase Auth
- ✅ Dynamic Praxis Profile with radar chart visualization
- ✅ **Profile editing with public/private toggle**
- ✅ Competency Library with Smart Study Assistant (AI Q&A)
- ✅ Interactive Case Simulations with two-panel workspace
- ✅ **AI Role-Play Engine for stakeholder negotiations**
- ✅ AI-powered Performance Debriefing
- ✅ **Community Forum with full thread/post creation**
- ✅ **Complete Admin Content Management (kanban board + editor)**
- ✅ Public/Private user profiles with full editing

### Sample Content
- 3 Complete Articles:
  - Framework: ROI & CAC
  - Framework: The Innovator's Dilemma
  - Framework: OPEX vs. CAPEX
- 3 Business Case Simulations:
  - The Growth Engine Challenge
  - The Innovation & Disruption Challenge
  - The Operational Efficiency Challenge

## Getting Started

### Prerequisites

- Node.js 18+
- Docker (for local Supabase)
- Supabase CLI
- Google Gemini API key

### Installation

1. **Clone and install dependencies:**
```bash
cd praxis-platform
npm install
```

2. **Start local Supabase:**
```bash
supabase start
```

This will:
- Run all database migrations
- Seed the database with sample content (3 articles, 3 cases, 5 competencies, 4 forum channels)
- Start Supabase Studio at `http://127.0.0.1:54333`

3. **Configure environment variables:**

Copy the example file and fill in your credentials:

```bash
cp .env.example .env.local
```

Then edit `.env.local` and add all required API keys. See `.env.example` for the complete list of required variables.

**Minimum required for local development:**
- `NEXT_PUBLIC_SUPABASE_URL` (auto-generated by `supabase start`)
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` (auto-generated by `supabase start`)
- `SUPABASE_SERVICE_ROLE_KEY` (auto-generated by `supabase start`)
- `GEMINI_API_KEY` (get from https://makersuite.google.com/app/apikey)

4. **Start the development server:**
```bash
npm run dev
```

The application will be available at `http://localhost:3400`

## Local Supabase Configuration

This project uses custom ports to avoid conflicts:
- API: `54331`
- Database: `54332`
- Studio: `54333`
- Inbucket (email testing): `54334`

Access Supabase Studio: `http://127.0.0.1:54333`

## Project Structure

```
praxis-platform/
├── app/
│   ├── (auth)/              # Authentication pages
│   │   ├── login/
│   │   ├── signup/
│   │   └── callback/
│   ├── (app)/               # Main application (protected)
│   │   ├── dashboard/
│   │   ├── library/         # Competency Library
│   │   ├── simulations/     # Case Simulations
│   │   ├── debrief/         # Performance Debriefs
│   │   ├── community/       # Forum
│   │   ├── profile/         # User Profiles
│   │   └── admin/           # Admin Panel
│   ├── layout.tsx
│   └── page.tsx
├── components/
│   ├── ui/                  # Shadcn/ui components
│   ├── layout/              # Navigation, layouts
│   ├── profile/             # Profile & radar chart
│   ├── simulation/          # Simulation workspace
│   ├── library/             # Study assistant
│   └── admin/               # Admin components
├── lib/
│   └── supabase/            # Supabase clients
├── types/
│   └── database.types.ts    # TypeScript types
├── supabase/
│   ├── migrations/          # Database migrations
│   ├── functions/           # Edge Functions
│   │   ├── ask-study-assistant/
│   │   └── generate-debrief/
│   ├── seed.sql             # Sample content
│   └── config.toml          # Supabase configuration
└── middleware.ts            # Auth middleware
```

## Database Schema

### Core Tables
- `profiles` - User profiles with roles
- `competencies` - Hierarchical competency framework
- `articles` - Competency library articles
- `cases` - Business case simulations
- `simulations` - User simulation attempts
- `debriefs` - AI Coach feedback
- `forum_channels`, `forum_threads`, `forum_posts` - Community forum

### Key Features
- Row-Level Security (RLS) enabled on all tables
- Role-based access control (member, editor, admin)
- Automatic profile creation on signup
- Database functions for aggregate scores and recommendations

## AI Integration

### Edge Functions

#### `/functions/v1/ask-study-assistant`
- Powers the Smart Study Assistant in the Competency Library
- Answers user questions based strictly on article content
- Uses Gemini API with constrained prompts

#### `/functions/v1/generate-debrief`
- Generates performance debriefs after simulation completion
- Evaluates user inputs against static rubrics
- Returns structured JSON with scores and feedback

## Usage

### For Users

1. **Sign Up**: Create an account at `/signup`
2. **Explore Library**: Read foundational articles with AI assistance
3. **Start Simulation**: Choose a case and work through decisions
4. **Get Debrief**: Receive AI-powered performance feedback
5. **Build Profile**: Complete simulations to build your radar chart
6. **Join Community**: Discuss with other members in the forum

### For Admins

Access the admin panel at `/admin` to:
- View platform statistics
- Manage content (articles and cases)
- Monitor user activity

## Development

### Running Tests
```bash
npm run test
```

### Type Checking
```bash
npm run type-check
```

### Database Management

View database:
```bash
supabase db diff
```

Reset database:
```bash
supabase db reset
```

Generate TypeScript types:
```bash
supabase gen types typescript --local > types/database.types.ts
```

## Database Migrations

### Local Development
```bash
# Create a new migration
npx prisma migrate dev --name your-migration-name

# Apply pending migrations
npx prisma migrate deploy

# Reset database (development only - deletes all data)
npx prisma migrate reset
```

### Staging/Production Migration Process

**Important**: Always test migrations in staging before applying to production!

1. **Create migration locally:**
   ```bash
   npx prisma migrate dev --name your-migration-name
   ```

2. **Test in staging:**
   - Push migration files to staging branch
   - CI/CD will run migrations automatically
   - Verify application works correctly

3. **Apply to production:**
   ```bash
   # Option A: Via Supabase CLI (recommended)
   supabase link --project-ref your-production-project-ref
   supabase db push
   
   # Option B: Via Prisma directly
   DATABASE_URL=$PRODUCTION_DATABASE_URL npx prisma migrate deploy
   ```

4. **Generate Prisma Client:**
   ```bash
   npx prisma generate
   ```

5. **Deploy Edge Functions** (if schema changes affect them):
   ```bash
   supabase functions deploy ask-study-assistant
   supabase functions deploy generate-debrief
   supabase functions deploy ai-persona-chat
   supabase functions deploy weekly-digest
   ```

### Rollback Procedure

If a migration causes issues:

1. **Immediate**: Revert deployment (Vercel allows instant rollback)
2. **Database**: Apply rollback migration:
   ```bash
   # Create rollback migration that reverses changes
   npx prisma migrate dev --name rollback-migration-name
   # Review carefully before applying to production
   ```
3. **Long-term**: Keep migration files in version control for traceability

## Deployment

### Environment Setup

1. **Copy environment variables:**
   ```bash
   cp .env.example .env.local
   ```

2. **Fill in all required variables** (see `.env.example` for list)

### Frontend (Vercel)

1. Connect your GitHub repository to Vercel
2. Add environment variables in Vercel dashboard:
   - Development environment
   - Preview environment (for PRs)
   - Production environment
3. Vercel automatically deploys:
   - Every push to `main` → Production
   - Every PR → Preview deployment
4. CI/CD checks run automatically (see `.github/workflows/`)

### Backend (Supabase Cloud)

1. **Create Supabase projects:**
   - Development project (for local dev)
   - Staging project (for testing)
   - Production project

2. **Link local project:**
   ```bash
   supabase link --project-ref your-project-ref
   ```

3. **Apply migrations:**
   ```bash
   supabase db push  # Development
   # Or use production project ref for production
   ```

4. **Deploy Edge Functions:**
   ```bash
   supabase functions deploy ask-study-assistant
   supabase functions deploy generate-debrief
   supabase functions deploy ai-persona-chat
   supabase functions deploy weekly-digest
   ```

5. **Set up Secrets** (for Edge Functions):
   ```bash
   supabase secrets set GEMINI_API_KEY=your-key
   supabase secrets set RESEND_API_KEY=your-key
   supabase secrets set CRON_SECRET=your-secret
   ```

6. **Configure Supabase Cron** (for weekly digest):
   - In Supabase Dashboard, set up cron job
   - Schedule: `0 9 * * 1` (Every Monday at 9 AM UTC)
   - Endpoint: `/functions/v1/weekly-digest`
   - Headers: `x-cron-secret: your-secret`

## License

Proprietary - Praxis Platform

## Support

For issues or questions, contact the development team.
